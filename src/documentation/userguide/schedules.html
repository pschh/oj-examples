<html>
	<head>
		<title>User Guide - Schedules</title>
		<style type="text/css">
			@import url(styles.css);
		</style>
	</head>
	<body>

		<a name="top"></a>
		<h1>Oddjob Schedules</h1>

		<p>Flexitime.</p>
		
		<ul>
			<li><a href="#introduction">Introduction</a></li>
			<li><a href="#moving">Moving Intervals</a></li>
			<li><a href="#constrained">Constrained Schedules</a></li>
			<li><a href="#refining">Refining Schedules</a></li>
			<li><a href="#fixed">Fixed Intervals</a></li>
			<li><a href="#lists">Schedule Lists</a></li>
			<li><a href="#broken">Broken Schedules</a></li>
			<li><a href="#last">Last Intervals</a></li>
		</ul>

	<a name="introduction"></a>
	<h4>Introduction</h4>
		
		<p>Oddjob Schedules provide a very flexible way of defining the 
		schedule for running a job. Oddjob Schedules work with intervals of
		time. Here's an interval:</p>
		 
		<img src="images/schedules1.jpg" alt="An Interval"/>

		<p>In Oddjob this would be defined with the following XML:</p>
		
{@oddjob.xml.file examples/userguide/schedules1.xml}
		
		<p>Or defined in Oddjob Designer it would look like this:</p>

		<img src="images/schedules-ex1.gif" alt="Date Schedule Definition"/>
		
		<p>This interval spans the whole of that Tuesday, that was the
		16th of March 2010, from midnight until 1 millisecond
		before midnight that night.</p>

	<a name="moving"></a>
	<h4>Moving Intervals</h4>
		
		<p>More commonly an interval is not specified between fixed points
		in time. This schedule returns the interval
		that is the next day of the week that is a Tuesday.</p>
		
{@oddjob.xml.file examples/userguide/schedules2.xml}
		
		<p>The Tuesday selected depends on the time now.</p>
		
		<img src="images/schedules2.jpg" alt="Repeating Intervals"/>
		
		
		
		<p>On Tuesday the interval is for all of that Tuesday.</p>

		<img src="images/schedules3.jpg" alt="Repeating Intervals"/>
		
		<p>And from 00:00 Wednesday the interval is for the following
		Tuesday.</p>

		<img src="images/schedules4.jpg" alt="Repeating Intervals"/>
		
	<a name="constrained"></a>
	<h4>Constrained Schedules</h4>
		
		<p>The dayofweek schedule allows an interval to be defined from the
		start of one day of the week to the end of another day of the week.
		This has exactly the same effect as the above:</p>
		
{@oddjob.xml.file examples/userguide/schedules2a.xml}

		<p>Note that this is an interval of 1 day, not 7 days. If the 'on' 
		attribute is given, from and to are ignored.</p>

		<p>Regular schedules that are specified with a 'from' and a 'to' are
		are called Constrained Schedules. They are:</p>
		
		<ul>
			<li><a href="@reference@/org/oddjob/schedules/schedules/MonthSchedule.html">
			month</a></li>
			<li><a href="@reference@/org/oddjob/schedules/schedules/DayOfYearSchedule.html">
			dayofyear</a></li>
			<li><a href="@reference@/org/oddjob/schedules/schedules/DayOfMonthSchedule.html">
			dayofmonth</a></li>
			<li><a href="@reference@/org/oddjob/schedules/schedules/DayOfWeekSchedule.html">
			dayofweek</a></li>
			<li><a href="@reference@/org/oddjob/schedules/schedules/TimeSchedule.html">
			time</a></li>
		</ul>			
		
		<p>With all Constrained Schedules, if the 'from' is after the 'to', then 
		the specified interval is in the next unit of time. For instance:</p>
		
{@oddjob.xml.file examples/userguide/schedules3.xml}

		<p>Specifies an interval from this 1st of October to the end of April 
		next year (Or from last October if now is before April this year).</p>

	<a name="refining"></a>
	<h4>Refining Schedules</h4>
		
		<p>Many schedules allow a refinement schedule to be specified. 
		This is another schedule that 'refines' the interval of its parent.</p>

		<img src="images/schedules5.jpg" alt="Refined Schedule"/>
		
		
{@oddjob.xml.file examples/userguide/schedules4.xml}

       <p>This would schedule a job at 10am every Tuesday. In this instance the 
       <code>time</code>
       schedule has refined the <code>dayofweek</code> schedule. The day of week
       schedule has also 'limited' the time schedule. It no longer returns an
       interval that is every day from 10am to 1pm. The time now only applies 
       to Tuesdays. This limiting effect applies to the beginning of the interval,
       not the end. </p>
        
		<img src="images/schedules6.jpg" alt="Refine Schedule"/>

{@oddjob.xml.file examples/userguide/schedules5.xml}

		<p>Thus the interval is still applicable even if the time is 00:59am 
		Wednesday morning. At 1:00am precisely the interval moves on to the
		following week.</p>

	<a name="fixed"></a>
	<h4>Fixed Intervals</h4>

		<p>The <a href="@reference@/org/oddjob/schedules/schedules/IntervalSchedule.html">
			interval schedule</a> provides regular fixed length intervals.</p> 
		       
{@oddjob.xml.file examples/userguide/schedules6.xml}
                       
		<p>The schedule provides back to back intervals that are five seconds long. It would
		be used to schedule something every five seconds.</p>
		
{@oddjob.xml.file examples/userguide/schedules7.xml}
		
		<p>This will provide thirty minute intervals from 10pm Tuesday night until 1:30am Wednesday morning.
		Intervals are calculated form the parents limits and so would be on the hour and half our. The
		final interval runs until 1:30am even though it's parent finishes at 01:05. This is because, like
		the Constrained Schedules the limiting affect of the parent only applies to the beginning of the 
		interval.</p>

	<a name="lists"></a>
	<h4>Schedule Lists</h4>
		
		<p>The <a href="@reference@/org/oddjob/schedules/ScheduleList.html">
			list schedule</a> provides for even greater flexibility.</p> 
		       
{@oddjob.xml.file examples/userguide/schedules8.xml}

		<p>This would schedule a job at 8am every Monday, then at 9am and 3pm every
		other day.</p>
 
		<p>When a schedule is evaluated each schedule in the list is evaluated
		and the first due schedule is used as the next due date.</p>
		
		<p>The list of sub schedules can be quite unrelated.</p>
		
{@oddjob.xml.file examples/userguide/schedules9.xml}

		<ul>
  		<li>On Monday 5th of December at 11:00, the next due date was 00:00 that morning
  		so this would be due immediately</li>
  		<li>On Tuesday 6th of December at 11:00, the next due would be 14:00 that day.</li>
  		<li>On Wednesday 7th of December at 11:00, the next due would be 12:00 that day.</li>
  		</ul>
		
		<a name="broken"></a>
		<h4>Broken Schedules</h4>

		<p>We already saw in <a href="scheduling.html">scheduling</a> how
		<a href="@reference@/org/oddjob/schedules/schedules/BrokenSchedule.html">broken schedules</a>
		can be used to define holidays but here's a little more on how they work.</p>
		
		<img src="images/schedules7.jpg" alt="Broken Schedule"/>
		
		<p>The intervals defined by the breaks mask those defined by the
		regular schedule. As with other schedules, the break only masks 
		a interval where its start is in the break interval.</p>
		
		<a name="last"></a>
		<h4>Last Intervals</h4>
		
		<p>Last days of the month can achieved easily using the &lt;dayofmonth on="0"&gt;
		schedule. The last working day of the month is a bit harder, but can be achieved using
		the 
		<a href="@reference@/org/oddjob/schedules/schedules/LastSchedule.html">last schedule</a>. 
		The last schedule takes the last result of its refinement, so
		it calculates the month end by moving through all the days before the month end and 
		seeing if it's a working day or not.</p>
		
		<p>Here's an example that will run the job at 10pm on the last working day of 
		every month.</p>
		
{@oddjob.xml.file examples/userguide/schedules10.xml}

		<hr/>	

		<a href="index.html">Index</a> <a href="#top">Top</a>
		<a href="grabbing.html">Next</a>
	</body>
</html>
